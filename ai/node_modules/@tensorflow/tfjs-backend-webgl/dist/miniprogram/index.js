/**
 * @license
 * Copyright 2024 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@tensorflow/tfjs-core")):"function"==typeof define&&define.amd?define(["exports","@tensorflow/tfjs-core"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).tf=e.tf||{},e.tf)}(this,(function(e,n){"use strict";function t(e){var n=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var a=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,a.get?a:{enumerable:!0,get:function(){return e[t]}})}})),n.default=e,n}var a=t(n),r=function(e,n){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},r(e,n)};function o(e,n,t,a){return new(t||(t=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,c)}s((a=a.apply(e,n||[])).next())}))}function i(e,n){var t,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=n.call(e,i)}catch(e){o=[6,e],a=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function c(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],a=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,n){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var a,r,o=t.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(a=o.next()).done;)i.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(r)throw r.error}}return i}function u(e,n,t){if(t||2===arguments.length)for(var a,r=0,o=n.length;r<o;r++)!a&&r in n||(a||(a=Array.prototype.slice.call(n,0,r)),a[r]=n[r]);return e.concat(a||Array.prototype.slice.call(n))}var l,d,p,h={},f={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function x(e,n){h[e]=n}function v(e,t){if(!(e in h)||null!=t){var a=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var a=null==t?function(e){if(n.env().getBool("IS_SAFARI")||"undefined"==typeof OffscreenCanvas||2!==e){if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;a.addEventListener("webglcontextlost",(function(n){n.preventDefault(),delete h[e]}),!1),n.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(f.failIfMajorPerformanceCaveat=!1);if(1===e)return a.getContext("webgl",f)||a.getContext("experimental-webgl",f);return a.getContext("webgl2",f)}(e,t);if(null===a)return console.log("Could not get context for WebGL version",e),null;h[e]=a}var r=h[e];return null==r||r.isContextLost()?(delete h[e],v(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),h[e])}function g(e,n){return[n,e]}function m(e){var t=n.util.sizeFromShape(e),a=Math.ceil(t/4);return n.util.sizeToSquarishShape(a)}function b(e,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(e/2))]}function C(e,t){var a,r,o,i,c,s,u,l,d,p,h=e;return 2===n.env().getNumber("WEBGL_VERSION")?(a=h.R32F,r=h.R16F,o=h.RGBA16F,i=h.RGBA32F,c=h.RED,u=4,l=1,d=h.HALF_FLOAT,p=h.FLOAT,s=h.RGBA8):(a=e.RGBA,r=e.RGBA,o=e.RGBA,i=h.RGBA,c=e.RGBA,u=4,l=4,d=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:a,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:c,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:l,textureTypeHalfFloat:d,textureTypeFloat:p}}function y(e,t){var a=t();return n.env().getBool("DEBUG")&&function(e){var n=e.getError();if(n!==e.NO_ERROR)throw new Error("WebGL Error: "+I(e,n))}(e),a}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(l||(l={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(d||(d={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(p||(p={}));function w(e){return!!(n.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function I(e,n){switch(n){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(n)}}function S(e,n){return q(e,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function k(e,n){var t=q(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(y(e,(function(){return e.shaderSource(t,n)})),y(e,(function(){return e.compileShader(t)})),!1===e.getShaderParameter(t,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function R(e,t){var a=q(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(y(e,(function(){return e.shaderSource(a,t)})),y(e,(function(){return e.compileShader(a)})),n.env().get("ENGINE_COMPILE_ONLY"))return a;if(!1===e.getShaderParameter(a,e.COMPILE_STATUS))throw A(t,e.getShaderInfoLog(a)),new Error("Failed to compile fragment shader.");return a}var T,N,E=/ERROR: [0-9]+:([0-9]+):/g;function A(e,t){var a=E.exec(t);if(null==a)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+a[1],o=e.split("\n"),i=o.length.toString().length+2,c=o.map((function(e,t){return n.util.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<c.length;u++)s=Math.max(c[u].length,s);var l=c.slice(0,r-1),d=c.slice(r-1,r),p=c.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(n.util.rightPad(d[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function _(e){return q(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function O(e,t){if(y(e,(function(){return e.linkProgram(t)})),!n.env().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function F(e,n){if(y(e,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function D(e,n){var t=q(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return y(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,t)})),y(e,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),t}function P(e,n){var t=q(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return y(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)})),y(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),t}function L(e){return q(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function B(e,t){var a=n.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>a||t>a){r="[".concat(e,"x").concat(t,"]");var o="[".concat(a,"x").concat(a,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function V(e){return q(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function W(e,n,t,a,r,o,i){var c=e.getAttribLocation(n,t);return-1!==c&&(y(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,a)})),y(e,(function(){return e.vertexAttribPointer(c,r,e.FLOAT,!1,o,i)})),y(e,(function(){return e.enableVertexAttribArray(c)})),!0)}function U(e,n,t){Y(e,t),y(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),y(e,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function M(e,n,t){return q(e,(function(){return e.getUniformLocation(n,t)}),'uniform "'+t+'" not present in program.')}function G(e,n,t){return e.getUniformLocation(n,t)}function z(e,n,t,a){y(e,(function(){return U(e,n,a)})),y(e,(function(){return e.uniform1i(t,a)}))}function X(e,n,t){y(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),y(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function H(e,n){y(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),y(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function j(e){var n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(n!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+K(e,n))}function K(e,n){switch(n){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(n)}}function q(e,n,t){var a=y(e,(function(){return n()}));if(null==a)throw new Error(t);return a}function Y(e,n){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,a=n+e.TEXTURE0;if(a<e.TEXTURE0||a>t){var r="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(r,"."))}}function Q(e,t){return void 0===t&&(t=2),n.util.sizeFromShape(e.slice(0,e.length-t))}function Z(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function J(e){var n=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(n=u([Q(e)],s(Z(e)),!1)),n}function $(e,t){var a;void 0===t&&(t=!1);var r=n.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),o=n.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(o===1/0&&n.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(o=r/2),t&&(r*=2,o*=2,1===(e=e.map((function(t,a){return a>=e.length-2?n.util.nearestLargerEven(e[a]):e[a]}))).length&&(e=[2,e[0]])),2!==e.length){var i=n.util.squeezeShape(e);e=i.newShape}var c=n.util.sizeFromShape(e),l=null;e.length<=1&&c<=r?l=[1,c]:2===e.length&&e[0]<=r&&e[1]<=r?l=e:3===e.length&&e[0]*e[1]<=r&&e[2]<=r?l=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=r&&e[1]*e[2]<=r?l=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r?l=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r&&(l=[e[0],e[1]*e[2]*e[3]]);var d=null!=l&&Math.max.apply(Math,u([],s(l),!1))>o&&Math.min.apply(Math,u([],s(l),!1))<=(t?2:1)&&Math.min.apply(Math,u([],s(l),!1))>0;if(null==l||d)if(t){var p=Q(e),h=2,f=2;e.length&&(h=(a=s(Z(e),2))[0],f=a[1]),c=p*(h/2)*(f/2),l=n.util.sizeToSquarishShape(c).map((function(e){return 2*e}))}else l=n.util.sizeToSquarishShape(c);return l}function ee(e){return e%2==0}function ne(e,t){if(e=e.slice(-2),t=t.slice(-2),n.util.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var a=e[e.length-1],r=t[t.length-1];if(a===r)return!0;if(ee(a)&&ee(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&ee(e[0])&&ee(t[0])}function te(e){if(null==T){var n=v(e);T=n.getParameter(n.MAX_TEXTURE_SIZE)}return T}function ae(e){if(null==N){var n=v(e);N=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,N)}function re(e){if(0===e)return 0;var n=v(e);return oe(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:oe(n,"EXT_disjoint_timer_query")?1:0}function oe(e,n){return null!=e.getExtension(n)}function ie(e){try{if(null!=v(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function ce(e){if(0===e)return!1;var n=v(e);if(1===e){if(!oe(n,"OES_texture_float"))return!1}else if(!oe(n,"EXT_color_buffer_float"))return!1;return ue(n)}function se(e){if(0===e)return!1;var n=v(e);if(1!==e){if(oe(n,"EXT_color_buffer_float"))return ue(n);var t="EXT_color_buffer_half_float";if(oe(n,t)){var a=n.getExtension(t);return function(e,n){var t=C(e,n),a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a);var r=1,o=1;e.texImage2D(e.TEXTURE_2D,0,t.internalFormatHalfFloat,r,o,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0);var c=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(a),e.deleteFramebuffer(i),c}(n,a)}return!1}return!!oe(n,"OES_texture_float")&&(!!oe(n,"WEBGL_color_buffer_float")&&ue(n))}function ue(e){var n=C(e),t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);var r=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(t),e.deleteFramebuffer(a),r}function le(e){return 2===e&&null!=v(e).fenceSync}function de(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&n.util.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var pe={__proto__:null,assertNotComplex:de,bindCanvasToFramebuffer:function(e){y(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),y(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),y(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:X,bindTextureToProgramUniformSampler:z,bindTextureUnit:U,bindVertexBufferToProgramAttribute:W,callAndCheck:y,canBeRepresented:w,createFragmentShader:R,createFramebuffer:V,createProgram:_,createStaticIndexBuffer:P,createStaticVertexBuffer:D,createTexture:L,createVertexShader:k,getBatchDim:Q,getExtensionOrThrow:S,getFramebufferErrorMessage:K,getMaxTexturesInShader:ae,getNumChannels:function(){return 2===n.env().getNumber("WEBGL_VERSION")?1:4},getProgramUniformLocation:G,getProgramUniformLocationOrThrow:M,getRowsCols:Z,getShapeAs3D:J,getTextureShapeFromLogicalShape:$,getWebGLDisjointQueryTimerVersion:re,getWebGLErrorMessage:I,getWebGLMaxTextureSize:te,hasExtension:oe,isCapableOfRenderingToFloatTexture:ce,isDownloadFloatTextureEnabled:se,isReshapeFree:ne,isWebGLFenceEnabled:le,isWebGLVersionEnabled:ie,linkProgram:O,logShaderSourceAndInfoLog:A,resetMaxTextureSize:function(){T=null},resetMaxTexturesInShader:function(){N=null},unbindColorTextureFromFramebuffer:H,unbindTextureUnit:function(e,n){Y(e,n),y(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),y(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},validateFramebuffer:j,validateProgram:F,validateTextureSize:B},he=n.env();function fe(){var e,t,a,r,o,i,c,s,u,l;return 2===n.env().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",a="out",r="in",o="texture",i="outputColor",c="out vec4 outputColor;",s=n.env().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",a="varying",r="varying",o="texture2D",i="gl_FragColor",c="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:a,varyingFs:r,texture2D:o,output:i,defineOutput:c,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function xe(e,t,a){void 0===a&&(a="index");var r=n.util.computeStrides(t);return r.map((function(n,t){var o="int ".concat(e[t]," = ").concat(a," / ").concat(n),i=t===r.length-1?"int ".concat(e[t+1]," = ").concat(a," - ").concat(e[t]," * ").concat(n):"index -= ".concat(e[t]," * ").concat(n);return"".concat(o,"; ").concat(i,";")})).join("")}function ve(e,t,a){void 0===a&&(a="index");var r=n.util.computeStrides(t);return r.map((function(n,t){var o="int ".concat(e[t]," = ").concat(a," / outShapeStrides[").concat(t,"]"),i=t===r.length-1?"int ".concat(e[t+1]," = ").concat(a," - ").concat(e[t]," * outShapeStrides[").concat(t,"]"):"index -= ".concat(e[t]," * outShapeStrides[").concat(t,"]");return"".concat(o,"; ").concat(i,";")})).join("")}function ge(e,n,t){void 0===t&&(t="index");var a=function(e,n){var t=e.length,a=e.map((function(e){return"".concat(n,"[").concat(e,"]")})),r=new Array(t-1);r[t-2]=a[t-1];for(var o=t-3;o>=0;--o)r[o]="(".concat(r[o+1]," * ").concat(a[o+1],")");return r}(e.map((function(e,n){return n})),n);return a.map((function(n,r){var o="int ".concat(e[r]," = ").concat(t," / ").concat(a[r]),i=r===a.length-1?"int ".concat(e[r+1]," = ").concat(t," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(o,"; ").concat(i,";")})).join("")}function me(e){var t=n.util.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}he.registerFlag("HAS_WEBGL",(function(){return he.getNumber("WEBGL_VERSION")>0})),he.registerFlag("WEBGL_VERSION",(function(){return ie(2)?2:ie(1)?1:0})),he.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),he.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===he.get("WEBGL_VERSION")})),he.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),he.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),he.registerFlag("WEBGL_PACK",(function(){return he.getBool("HAS_WEBGL")})),he.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_CLIP",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_REDUCE",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_CONV_IM2COL",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",(function(){return he.getBool("WEBGL_PACK")})),he.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return te(he.getNumber("WEBGL_VERSION"))})),he.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return ae(he.getNumber("WEBGL_VERSION"))})),he.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=he.getNumber("WEBGL_VERSION");return 0===e?0:re(e)})),he.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return he.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!n.device_util.isMobile()})),he.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return ce(he.getNumber("WEBGL_VERSION"))})),he.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!he.getBool("WEBGL_FORCE_F16_TEXTURES")&&he.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),he.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return se(he.getNumber("WEBGL_VERSION"))})),he.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return le(he.getNumber("WEBGL_VERSION"))})),he.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return he.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),he.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if("number"!=typeof e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),he.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return n.device_util.isMobile()?1:-1}),(function(e){if("number"!=typeof e)throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(e,"."));if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),he.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),he.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),he.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),he.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),he.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),he.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return he.getBool("IS_TEST")})),he.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),he.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),he.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),he.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var be="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",Ce=n.backend_util.getBroadcastDims;function ye(e,t,a){var r=[];if(e.forEach((function(e){var t=n.util.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),a.enableShapeUniforms){switch(_e(a.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),a.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}a.customUniforms&&a.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var o,i,c=r.join("\n"),s=e.map((function(e){return function(e,t,a,r){void 0===a&&(a=!1);var o="";o+=a?Ie(e,r):we(e,r);var i=e.shapeInfo.logicalShape,c=t.logicalShape;i.length<=c.length&&(o+=a?function(e,t){var a,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",c=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Ce(e.shapeInfo.logicalShape,t.logicalShape),l=Ae(s),d=s-c,p=["x","y","z","w","u","v"];a=0===c?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+d]," = 0;")})).join("\n");var h="";h=s<2&&c>0?"coords":e.shapeInfo.logicalShape.map((function(e,n){return"coords.".concat(p[n+d])})).join(", ");var f="return outputValue;",x=1===n.util.sizeFromShape(e.shapeInfo.logicalShape),v=1===n.util.sizeFromShape(t.logicalShape);if(1!==c||x||v){if(x&&!v)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=c-2,m=c-1;u.indexOf(g)>-1&&u.indexOf(m)>-1?f="return vec4(outputValue.x);":u.indexOf(g)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(m)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(a,"\n      vec4 outputValue = get").concat(o,"(").concat(h,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){var a=e.name,r=a.charAt(0).toUpperCase()+a.slice(1),o="get"+r+"AtOutCoords",i=t.texShape,c=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&n.util.arraysEqual(c,i))return"\n      float ".concat(o,"() {\n        return sampleTexture(").concat(a,", resultUV);\n      }\n    ");var l,d=Ae(u),p=Ce(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,f=["x","y","z","w","u","v"];l=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var x="";x=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,n){return"coords.".concat(f[n+h])})).join(", ");return"\n    float ".concat(o,"() {\n      ").concat(d," coords = getOutputCoords();\n      ").concat(l,"\n      return get").concat(r,"(").concat(x,");\n    }\n  ")}(e,t));return o}(e,t,a.packedInputs,a.enableShapeUniforms)})).join("\n"),u=t.texShape,l=fe(),d=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(l),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Se,"\n    ").concat(ke,"\n    ").concat(Re,"\n  ")}(l);return t.isPacked?(o=function(e,t,a){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,n,t){var a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(1===a[0])return t?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(a[1],".0);\n      }\n    ");if(1===a[1])return t?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(a[0],".0);\n      }\n    ");if(t)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      return 2 * (resTexRC.x * ").concat(a[1]," + resTexRC.y);\n    }\n  ")}(0,t,a);case 2:return function(e,t,a){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(n.util.arraysEqual(e,t))return a?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var o=Math.ceil(e[1]/2);if(a)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(o,");\n      int c = imod(index, ").concat(o,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,a);case 3:return function(e,n,t){if(t)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      int index = resTexRC.x * ").concat(a[1]," + resTexRC.y;\n\n      int b = index / ").concat(o,";\n      index -= b * ").concat(o,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,a);default:return function(e,n,t){if(t)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),i=o,c="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],c="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+c,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(a[0],", ").concat(a[1],"));\n      int index = resTexRC.x * ").concat(a[1]," + resTexRC.y;\n\n      ").concat(c,"\n\n      int b = index / ").concat(o,";\n      index -= b * ").concat(o,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t,a)}}(t.logicalShape,u,a.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(l)):(o=function(e,t,a){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,n,t){if(1===n[0])return t?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(n[1],".0);\n      }\n    ");if(1===n[1])return t?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(n[0],".0);\n      }\n    ");if(t)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return resTexRC.x * ").concat(n[1]," + resTexRC.y;\n    }\n  ")}(0,t,a);case 2:return function(e,t,a){if(n.util.arraysEqual(e,t))return a?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return a?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return a?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(a)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,a);case 3:return function(e,n,t){if(t){var a=ve(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(a,"\n    return ivec3(r, c, d);\n  }\n")}var r=xe(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,a);case 4:return function(e,n,t){if(t){var a=ve(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var r=xe(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,a);case 5:return r=t,o=xe(["r","c","d","d2","d3"],e),"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(r[0],",\n                             ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ");case 6:return function(e,n){var t=xe(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(t,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}var r,o}(t.logicalShape,u,a.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(l)),a.packedInputs&&(p+=Te),[p,d,i,c,o,s,a.userCode].join("\n")}function we(e,t){void 0===t&&(t=!1);var a=e.shapeInfo.logicalShape;switch(a.length){case 0:return function(e,n){var t=e.name,a="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(a,"() {return ").concat(t,";}");var r=s(e.shapeInfo.texShape,2),o=r[0],i=r[1];if(1===o&&1===i)return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var c=Ne(t);if(n)return"\n    float ".concat(a,"() {\n      vec2 uv = uvFromFlat(").concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(c,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ");var u=s(e.shapeInfo.texShape,2),l=u[0],d=u[1];return"\n    float ".concat(a,"() {\n      vec2 uv = uvFromFlat(").concat(l,", ").concat(d,", ").concat(c,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e,t);case 1:return function(e,n){var t=e.name,a="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int index) {\n        ").concat(Ee(e),"\n      }\n    ");var r=e.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float ".concat(a,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var c=Ne(t);if(1===i)return n?"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(c,") + 0.5) / float(").concat(t,"TexShape[0]));\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(c,") + 0.5) / ").concat(o,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");if(1===o)return n?"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(c,") + 0.5) / float(").concat(t,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n      float ".concat(a,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(c,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");if(n)return"\n    float ".concat(a,"(int index) {\n      vec2 uv = uvFromFlat(").concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(c,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int index) {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(i,", index + ").concat(c,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var a=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&n.util.arraysEqual(a,i)){if(t)return"\n      float ".concat(o,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var c=i[0],s=i[1];return"\n    float ".concat(o,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(c,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=n.util.squeezeShape(a),l=u.newShape,d=u.keptDims,p=l;if(p.length<a.length){var h=Oe(e,p),f=["row","col"];return"\n      ".concat(we(h,t),"\n      float ").concat(o,"(int row, int col) {\n        return ").concat(o,"(").concat(Fe(f,d),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(o,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(a[1],", 1)));\n        ").concat(Ee(e),"\n      }\n    ");var x=i[0],v=i[1],g=Ne(r);if(1===v)return t?"\n      float ".concat(o,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(g,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(o,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(g,"), vec3(").concat(a[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(x,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===x)return t?"\n      float ".concat(o,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(g,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(o,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(g,"), vec3(").concat(a[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(v,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(o,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(o,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(a[1]," + col + ").concat(g,";\n    vec2 uv = uvFromFlat(").concat(x,", ").concat(v,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var a=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=a[1]*a[2],c=a[2],s=n.util.squeezeShape(a),u=s.newShape,l=s.keptDims,d=u;if(d.length<a.length){var p=Oe(e,d),h=["row","col","depth"];return"\n        ".concat(we(p,t),"\n        float ").concat(o,"(int row, int col, int depth) {\n          return ").concat(o,"(").concat(Fe(h,l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(o,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(c,", 1)));\n        ").concat(Ee(e),"\n      }\n    ");var f=e.shapeInfo.texShape,x=f[0],v=f[1],g=e.shapeInfo.flatOffset;if(v===i&&null==g)return t?"\n      float ".concat(o,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(o,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(c,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(v,".0, ").concat(x,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(v===c&&null==g)return t?"\n      float ".concat(o,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(o,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(a[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(v,".0, ").concat(x,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var m=Ne(r);if(t)return"\n    float ".concat(o,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(o,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(c," + depth + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(x,", ").concat(v,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var a=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=a[3],c=a[2]*i,s=a[1]*c,u=n.util.squeezeShape(a),l=u.newShape,d=u.keptDims;if(l.length<a.length){var p=Oe(e,l),h=["row","col","depth","depth2"];return"\n      ".concat(we(p,t),"\n      float ").concat(o,"(int row, int col, int depth, int depth2) {\n        return ").concat(o,"(").concat(Fe(h,d),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(c,", ").concat(i,", 1)));\n        ").concat(Ee(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,x=e.shapeInfo.texShape,v=x[0],g=x[1],m="int stride2 = ".concat(r,"Shape[3];"),b="int stride1 = ".concat(r,"Shape[2] * stride2;"),C="int stride0 = ".concat(r,"Shape[1] * stride1;");if(g===s&&null==f)return t?"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        ").concat(m,"\n        ").concat(b,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(c,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(g===i&&null==f)return t?"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(o,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(a[1]*a[2],", ").concat(a[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var y=Ne(r);if(t)return"\n    float ".concat(o,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(m,"\n      ").concat(b,"\n      ").concat(C,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(y,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(o,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(c," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index + ").concat(y,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,r="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t[4],i=t[3]*o,c=t[2]*i,s=t[1]*c,u=n.util.squeezeShape(t),l=u.newShape,d=u.keptDims;if(l.length<t.length){var p=Oe(e,l),h=["row","col","depth","depth2","depth3"];return"\n      ".concat(we(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Fe(h,d),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(c,", ").concat(i,", ").concat(o,")) +\n          depth3;\n        ").concat(Ee(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,x=e.shapeInfo.texShape,v=x[0],g=x[1];if(g===s&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(c,", ").concat(i,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");if(g===o&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");var m=Ne(a);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(c," + depth * ").concat(i," +\n          depth2 * ").concat(o," + depth3 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,r="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n.util.squeezeShape(t),i=o.newShape,c=o.keptDims;if(i.length<t.length){var s=Oe(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(we(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Fe(u,c),");\n      }\n    ")}var l=t[5],d=t[4]*l,p=t[3]*d,h=t[2]*p,f=t[1]*h;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(h,", ").concat(p,", ").concat(d,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(l,", 1)));\n        ").concat(Ee(e),"\n      }\n    ");var x=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,g=v[0],m=v[1];if(m===f&&null==x)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(h,", ").concat(p,", ").concat(d,", ").concat(l,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");if(m===l&&null==x)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    ");var b=Ne(a);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(h," + depth * ").concat(p," +\n          depth2 * ").concat(d," + depth3 * ").concat(l," + depth4 + ").concat(b,";\n      vec2 uv = uvFromFlat(").concat(g,", ").concat(m,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(a.length,"-D input sampling")+" is not yet supported")}}function Ie(e,t){var a,r,o;switch(e.shapeInfo.logicalShape.length){case 0:return a=e.name,r="get"+a.charAt(0).toUpperCase()+a.slice(1),o=fe(),"\n    vec4 ".concat(r,"() {\n      return ").concat(o.texture2D,"(").concat(a,", halfCR);\n    }\n  ");case 1:return function(e,n){var t=e.name,a="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=fe();if(n)return"\n    vec4 ".concat(a,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(o.texture2D,"(").concat(t,", uv);\n    }\n  ");var i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return"\n    vec4 ".concat(a,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(i[0],", ").concat(i[1],", index);\n      return ").concat(o.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var a=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,c=i[0],s=i[1],u=fe();if(null!=i&&n.util.arraysEqual(a,i))return t?"\n      vec4 ".concat(o,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(o,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(c,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(o,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(a[1]/2);return"\n    vec4 ".concat(o,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(d,", ").concat(l[0],", ").concat(l[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,n){var t=e.shapeInfo.logicalShape,a=e.name,r="get"+a.charAt(0).toUpperCase()+a.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0]){var c=[1,2],s=Oe(e,t.slice(1)),u=["b","row","col"];return"\n        ".concat(Ie(s,n),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(Fe(u,c),");\n        }\n      ")}var l=fe();if(n)return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(a,"TexShape[0]) / 2.0), ceil(float(").concat(a,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(a,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(a,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(a,", uv);\n    }\n  ");var d=i[0],p=i[1],h=Math.ceil(t[2]/2),f=h*Math.ceil(t[1]/2);return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(d,", ").concat(p,", ").concat(f,", ").concat(h,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(a,", uv);\n    }\n  ")}(e,t);default:return function(e,n){var t=e.name,a="get"+t.charAt(0).toUpperCase()+t.slice(1),r=fe();if(n)return"\n    vec4 ".concat(a,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(t,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(t,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(t,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(r.texture2D,"(").concat(t,", uv);\n    }\n  ");for(var o=e.shapeInfo.logicalShape,i=o.length,c=e.shapeInfo.texShape,s=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],u=s[0],l=s[1],d=Math.ceil(o[i-1]/2),p=d*Math.ceil(o[i-2]/2),h="int b, int row, int col",f="b * ".concat(p," + (row / 2) * ").concat(d," + (col / 2)"),x=2;x<i-1;x++)h="int b".concat(x,", ")+h,p*=o[i-x-1],f="b".concat(x," * ").concat(p," + ")+f;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(u,");\n      return ").concat(r.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e,t)}}var Se="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ke="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Re="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Te="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Ne(e){return"offset".concat(e)}function Ee(e){var t=e.name,a=n.util.sizeFromShape(e.shapeInfo.logicalShape);return a<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(a,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Ae(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function _e(e,t,a){var r=n.util.squeezeShape(t),o=r.newShape,i=r.keptDims,c=t.length,s=e&&3===c&&1===t[0],u=s?t.slice(1):o,l=!e&&c>1&&!n.util.arraysEqual(t,a)&&o.length<c||s;return{useSqueezeShape:l,uniformShape:l?u:t,keptDims:i}}function Oe(e,n){var t=JSON.parse(JSON.stringify(e));return t.shapeInfo.logicalShape=n,t}function Fe(e,n){return n.map((function(n){return e[n]})).join(", ")}function De(e,t,a){var r,o,i,s,u,l,d,p,h=[],f=[],x=null;p=e.getUniformLocation(a,"NAN",!1),1===n.env().getNumber("WEBGL_VERSION")&&(x=e.getUniformLocation(a,"INFINITY",!1));var v=!1;try{for(var g=c(t.variableNames),m=g.next();!m.done;m=g.next()){var b=m.value,C={name:b,uniform:e.getUniformLocation(a,b,v),offset:e.getUniformLocation(a,"offset".concat(b),v)};t.enableShapeUniforms&&(C.shape=e.getUniformLocation(a,"".concat(b,"Shape"),v),C.texShape=e.getUniformLocation(a,"".concat(b,"TexShape"),v)),h.push(C)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(o=g.return)&&o.call(g)}finally{if(r)throw r.error}}if(t.enableShapeUniforms&&(u=e.getUniformLocation(a,"outShape",v),d=e.getUniformLocation(a,"outShapeStrides",v),l=e.getUniformLocation(a,"outTexShape",v)),t.customUniforms)try{for(var y=c(t.customUniforms),w=y.next();!w.done;w=y.next()){var I=w.value;f.push(e.getUniformLocation(a,I.name,v))}}catch(e){i={error:e}}finally{try{w&&!w.done&&(s=y.return)&&s.call(y)}finally{if(i)throw i.error}}return{variablesLocations:h,customUniformLocations:f,infLoc:x,nanLoc:p,outShapeLocation:u,outShapeStridesLocation:d,outTexShapeLocation:l}}function Pe(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,a){var r=e.logicalShape,o=t[a],i=o.shape;if(!n.util.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!o.isUniform){var c=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!n.util.arraysEqual(c,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(c," and ").concat(s," must match"))}}))}function Le(e){return n.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Be=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=l.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=fe();this.outputShape=e,this.enableShapeUniforms=Le(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?ve(["r","c","d"],e):xe(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},Ve=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=l.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=fe();this.outputShape=e,this.enableShapeUniforms=Le(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?ve(["r","c","d"],e):xe(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},We=function(e){this.variableNames=["A"],this.outTexUsage=d.DOWNLOAD;var n=fe();this.outputShape=e,this.userCode="\n      ".concat(be,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},Ue=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=d.DOWNLOAD;var n=fe();this.outputShape=e,this.userCode="\n      ".concat(be,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},Me={R:0,G:1,B:2,A:3},Ge=function(e,n,t){void 0===n&&(n=!1),void 0===t&&(t="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=fe();this.outputShape=e,this.enableShapeUniforms=Le(this.outputShape.length);var r="result";n&&(r="floor(result * 255. + 0.5)");for(var o="",i=0;i<t.length;i++){var c=t[i];o+="\n          if(offset == ".concat(i,") {\n            result = values[").concat(Me[c],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":me(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(t.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(t.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(r,", 0., 0., 0.);\n      }\n    ")},ze=function(e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=fe();this.outputShape=e,this.enableShapeUniforms=Le(this.outputShape.length);var a="",r="result";n&&(r="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var i=0;i<=1;i++){var c=2*o+i;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(i," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),") {\n          localCoords[2] += ").concat(i,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(t.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(c,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(c,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(c,"] = values[2];\n            } else {\n              result[").concat(c,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":me(e),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(t.output," = ").concat(r,";\n        }\n    ")};function Xe(e){var n=fe();return k(e,"".concat(n.version,"\n    precision highp float;\n    ").concat(n.attribute," vec3 clipSpacePos;\n    ").concat(n.attribute," vec2 uv;\n    ").concat(n.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function He(e){return D(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function je(e){return P(e,new Uint16Array([0,1,2,2,1,3]))}function Ke(e,t,a,r,o,i){B(t,a);var c=L(e),s=e.TEXTURE_2D;return y(e,(function(){return e.bindTexture(s,c)})),y(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),y(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),y(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),y(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===n.env().getNumber("WEBGL_VERSION")?y(e,(function(){return e.texImage2D(s,0,r,t,a,0,o,i,null)})):y(e,(function(){return e.texStorage2D(s,1,r,t,a)})),y(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:c,texShape:[a,t]}}function qe(e){return e.internalFormatFloat}function Ye(e,n,t,a){var r=s(g(n,t),2);return Ke(e,r[0],r[1],qe(a),a.textureFormatFloat,e.FLOAT)}function Qe(e){return e.internalFormatHalfFloat}function Ze(e,n,t,a){var r=s(g(n,t),2);return Ke(e,r[0],r[1],Qe(a),a.textureFormatFloat,a.textureTypeHalfFloat)}function Je(e){return e.downloadTextureFormat}function $e(e,n,t,a){var r=s(g(n,t),2);return Ke(e,r[0],r[1],Je(a),e.RGBA,e.UNSIGNED_BYTE)}function en(e){return e.internalFormatPackedFloat}function nn(e,n,t,a){var r=s(b(n,t),2);return Ke(e,r[0],r[1],en(a),e.RGBA,e.FLOAT)}function tn(e){return e.internalFormatPackedHalfFloat}function an(e,n,t,a){var r=s(b(n,t),2);return Ke(e,r[0],r[1],tn(a),e.RGBA,a.textureTypeHalfFloat)}function rn(e,n,t){return y(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,t)})),W(e,n,"clipSpacePos",t,3,20,0)&&W(e,n,"uv",t,2,20,12)}function on(e,t,a,r,o,i){var c,s,u;y(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),o instanceof Uint8Array?(c=new Uint8Array(a*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(c=new Float32Array(a*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),c.set(o),2===n.env().getNumber("WEBGL_VERSION")?y(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,a,r,e.RGBA,s,c)})):y(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,a,r,0,e.RGBA,s,c)})),y(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function cn(e,t,a){y(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a.data instanceof Uint8Array?2===n.env().getNumber("WEBGL_VERSION")?y(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,a.width,a.height,e.RGBA,e.UNSIGNED_BYTE,a.data)})):y(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a.width,a.height,0,e.RGBA,e.UNSIGNED_BYTE,a.data)})):2===n.env().getNumber("WEBGL_VERSION")?y(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,a)})):y(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a)})),y(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function sn(e,n,t,a){var r=e.createBuffer();y(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,r)}));var o=16*n*t;return y(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),y(e,(function(){return e.readPixels(0,0,t,n,e.RGBA,e.FLOAT,0)})),y(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),r}function un(e,n,t){var a=e,r=new Float32Array(t);return a.bindBuffer(a.PIXEL_PACK_BUFFER,n),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,r),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),r}function ln(e,n,t,a){var r=s(g(n,t),2),o=r[0],i=r[1],c=new Uint8Array(n*t*4);return y(e,(function(){return e.readPixels(0,0,o,i,a.downloadTextureFormat,e.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}function dn(e,n,t,a,r,o,i,c){var u=e,l=new Float32Array(function(e,n){var t=s(b(e,n),2);return t[0]*t[1]*4}(o,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function pn(e,n,t){var a=new Float32Array(n*t*4);return y(e,(function(){return e.readPixels(0,0,t,n,e.RGBA,e.FLOAT,a)})),a}var hn={__proto__:null,bindVertexProgramAttributeStreams:rn,createBufferFromOutputTexture:sn,createFloat16MatrixTexture:Ze,createFloat16PackedMatrixTexture:an,createFloat32MatrixTexture:Ye,createIndexBuffer:je,createPackedMatrixTexture:nn,createUnsignedBytesMatrixTexture:$e,createVertexBuffer:He,createVertexShader:Xe,downloadByteEncodedFloatMatrixFromOutputTexture:ln,downloadFloat32MatrixFromBuffer:un,downloadMatrixFromPackedOutputTexture:pn,downloadPackedMatrixFromBuffer:dn,getInternalFormatForFloat16MatrixTexture:Qe,getInternalFormatForFloat16PackedMatrixTexture:tn,getInternalFormatForFloat32MatrixTexture:qe,getInternalFormatForPackedMatrixTexture:en,getInternalFormatForUnsignedBytesMatrixTexture:Je,uploadDenseMatrixToTexture:on,uploadPixelDataToTexture:cn},fn=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=n.env().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,x(t,e)):this.gl=v(t),e=this.gl,2===n.env().getNumber("WEBGL_VERSION")){var a=e;this.createVertexArray=function(){return y(a,(function(){return a.createVertexArray()}))},this.bindVertexArray=function(e){return y(a,(function(){return a.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return y(a,(function(){return a.deleteVertexArray(e)}))},this.getVertexArray=function(){return y(a,(function(){return a.getParameter(a.VERTEX_ARRAY_BINDING)}))}}else if(null!=e){var r=e.getExtension("OES_vertex_array_object");if(null==r)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return y(e,(function(){return r.createVertexArrayOES()}))},this.bindVertexArray=function(n){return y(e,(function(){return r.bindVertexArrayOES(n)}))},this.deleteVertexArray=function(n){return y(e,(function(){return r.deleteVertexArrayOES(n)}))},this.getVertexArray=function(){return y(e,(function(){return e.getParameter(r.VERTEX_ARRAY_BINDING_OES)}))}}var o="WEBGL_color_buffer_float",i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===n.env().getNumber("WEBGL_VERSION")){var c="OES_texture_half_float";if(this.textureFloatExtension=S(this.gl,"OES_texture_float"),oe(this.gl,c))this.textureHalfFloatExtension=S(this.gl,c);else if(n.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(o),oe(this.gl,i))this.colorBufferHalfFloatExtension=S(this.gl,i);else if(n.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(o="EXT_color_buffer_float",oe(this.gl,o))this.colorBufferFloatExtension=this.gl.getExtension(o);else{if(!oe(this.gl,i))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(i)}this.vertexBuffer=He(this.gl),this.indexBuffer=je(this.gl),this.framebuffer=V(this.gl),this.textureConfig=C(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return n.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;y(n,(function(){return n.finish()})),y(n,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)})),y(n,(function(){return n.deleteFramebuffer(e.framebuffer)})),y(n,(function(){return n.bindBuffer(n.ARRAY_BUFFER,null)})),y(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)})),y(n,(function(){return n.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,n){return this.throwIfDisposed(),Ye(this.gl,e,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,n){return this.throwIfDisposed(),Ze(this.gl,e,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,n){return this.throwIfDisposed(),$e(this.gl,e,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,n){this.throwIfDisposed(),cn(this.gl,e,n)},e.prototype.uploadDenseMatrixToTexture=function(e,n,t,a){this.throwIfDisposed(),on(this.gl,e,n,t,a,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,n){return this.throwIfDisposed(),an(this.gl,e,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,n){return this.throwIfDisposed(),nn(this.gl,e,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var n=this;this.throwIfDisposed(),this.outputTexture===e&&(H(this.gl,this.framebuffer),this.outputTexture=null),y(this.gl,(function(){return n.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,n,t){var a=this;return this.downloadMatrixDriver(e,(function(){return ln(a.gl,n,t,a.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,n,t,a,r,o){return dn(this.gl,e,0,0,0,r,o,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,n){return un(this.gl,e,n)},e.prototype.createBufferFromTexture=function(e,n,t){this.bindTextureToFrameBuffer(e);var a=sn(this.gl,n,t,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,a,r=this;if(n.env().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var e=o.clientWaitSync(i,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=i}else n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),a=function(){return r.isQueryAvailable(t,n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:t,isFencePassed:a}},e.prototype.downloadMatrixFromPackedTexture=function(e,n,t){var a=this;return this.downloadMatrixDriver(e,(function(){return pn(a.gl,n,t)}))},e.prototype.createProgram=function(e){var n=this;this.throwIfDisposed();var t=this.gl;null==this.vertexShader&&(this.vertexShader=Xe(t));var a=_(t);y(t,(function(){return t.attachShader(a,n.vertexShader)})),y(t,(function(){return t.attachShader(a,e)})),O(t,a);var r=Object.assign(a,{vao:this.createVertexArray()});return this.debug&&F(t,r),r},e.prototype.buildVao=function(e){var n=this;this.setProgram(e),this.bindVertexArray(e.vao);var t=this.gl;y(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.indexBuffer)})),rn(t,e,this.vertexBuffer)},e.prototype.deleteProgram=function(e){var n=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(y(this.gl,(function(){return n.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))},e.prototype.setProgram=function(e){var n=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&F(this.gl,this.program),y(this.gl,(function(){return n.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,n,t){return void 0===t&&(t=!0),this.throwIfDisposed(),t?M(this.gl,e,n):G(this.gl,e,n)},e.prototype.getAttributeLocation=function(e,n){var t=this;return this.throwIfDisposed(),y(this.gl,(function(){return t.gl.getAttribLocation(e,n)}))},e.prototype.getUniformLocationNoThrow=function(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)},e.prototype.setInputMatrixTexture=function(e,n,t){this.throwIfDisposed(),this.throwIfNoProgram(),z(this.gl,e,n,t)},e.prototype.setOutputMatrixTexture=function(e,n,t){this.setOutputMatrixTextureDriver(e,t,n)},e.prototype.setOutputPackedMatrixTexture=function(e,n,t){this.throwIfDisposed();var a=s(b(n,t),2),r=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,r,o)},e.prototype.setOutputMatrixWriteRegion=function(e,n,t,a){this.setOutputMatrixWriteRegionDriver(t,e,a,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,n,t,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&F(this.gl,this.program),j(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}y(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),y(this.gl,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=S(this.gl,2===n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),a=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,a),a}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,a=this.getQueryTimerExtensionWebGL2();t.endQuery(a.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return o(this,void 0,void 0,(function(){var t=this;return i(this,(function(a){switch(a.label){case 0:return[4,n.util.repeatedTry((function(){return t.disposed||t.isQueryAvailable(e,n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return a.sent(),[2,this.getQueryTime(e,n.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,n){if(0===n)return null;if(2===n){var t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(e,a.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,n){if(0===n)return!0;if(2===n){var t=this.gl,a=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),r&&!this.disjoint}r=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),r&&!this.disjoint},e.prototype.pollFence=function(e){var n=this;return new Promise((function(t){n.addItemToPoll((function(){return e.isFencePassed()}),(function(){return t()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var n=0;n<e.length;++n){if(!e[n]())break}return n-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),n=0;n<=e;++n){(0,this.itemsToPoll[n].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var a=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var r=void 0;"setTimeoutCustom"in n.env().platform&&(r=n.env().platform.setTimeoutCustom.bind(n.env().platform)),n.util.repeatedTry((function(){return a.pollItems(),0===a.itemsToPoll.length}),(function(){return 0}),null,r)}},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),X(this.gl,e,this.framebuffer),this.debug&&j(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(X(this.gl,this.outputTexture,this.framebuffer),this.debug&&j(this.gl)):H(this.gl,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,n){this.bindTextureToFrameBuffer(e);var t=n();return this.unbindTextureToFrameBuffer(),t},e.prototype.setOutputMatrixTextureDriver=function(e,n,t){this.throwIfDisposed();var a=this.gl;X(a,e,this.framebuffer),this.debug&&j(a),this.outputTexture=e,y(a,(function(){return a.viewport(0,0,n,t)})),y(a,(function(){return a.scissor(0,0,n,t)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,n,t,a){var r=this;this.throwIfDisposed(),y(this.gl,(function(){return r.gl.scissor(e,n,t,a)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function xn(e){return function(t,a,r,o,i){var c=n.backend_util.assertAndGetBroadcastShape(t,a),s=c.length,u=n.util.computeStrides(c),l=n.util.sizeFromShape(c),d=n.util.getTypedArrayFromDType(i,l),p=t.length,h=a.length,f=n.util.computeStrides(t),x=n.util.computeStrides(a),v=n.backend_util.getBroadcastDims(t,c),g=n.backend_util.getBroadcastDims(a,c);if(v.length+g.length===0)for(var m=0;m<d.length;++m)d[m]=e(r[m%r.length],o[m%o.length]);else{var b=function(t){var a=n.util.indexToLoc(t,s,u),i=a.slice(-p);v.forEach((function(e){return i[e]=0}));var c=n.util.locToIndex(i,p,f),l=a.slice(-h);g.forEach((function(e){return l[e]=0}));var m=n.util.locToIndex(l,h,x);d[t]=e(r[c],o[m])};for(m=0;m<d.length;++m)b(m)}return[d,c]}}var vn=xn((function(e,n){return e+n}));var gn=xn((function(e,n){return e&n}));function mn(e){return function(t,a,r){for(var o=n.util.getArrayFromDType(a,t.length),i=0;i<t.length;++i)o[i]=e(t[i],r);return o}}var bn=mn((function(e){return Math.ceil(e)}));var Cn=xn((function(e,n){return e===n?1:0})),yn=mn((function(e){return Math.exp(e)})),wn=mn((function(e){return Math.expm1(e)})),In=mn((function(e){return Math.floor(e)}));var Sn=xn((function(e,n){return e>n?1:0})),kn=xn((function(e,n){return e>=n?1:0})),Rn=xn((function(e,n){return e<n?1:0})),Tn=xn((function(e,n){return e<=n?1:0}));var Nn=mn((function(e){return Math.log(e)}));var En=xn((function(e,n){return Math.max(e,n)})),An=xn((function(e,n){return Math.min(e,n)})),_n=xn((function(e,n){return e*n}));var On=xn((function(e,n){return e!==n?1:0}));function Fn(e,n,t,a){var r=[],o=0,i=n.length-1+t.length,c=new Array(i).fill(null).map((function(){return[0]}));!function(e,n){for(var t=0;t<e.length;++t){var a=e[t],r=t===e.length-1?n:e[t+1].length;if(0===a.length)throw new Error("Ragged splits may not be empty");if(a[0]<0)throw new Error("Ragged splits must be non-negative");if(a[a.length-1]>r)throw new Error("Ragged splits must not point past values");for(var o=1;o<a.length;++o)if(a[o-1]>a[o])throw new Error("Ragged splits must be sorted in ascending order")}}(t,a);for(var s=1,u=0;u<n.length-1;++u){s*=n[u];for(var l=n[u+1],d=1;d<s+1;++d)c[u].push(d*l)}for(d=0;d<e.length;++d){var p=e[d],h=e[d]+1;for(u=0;u<t.length;++u){var f=t[u],x=u+n.length-1;if(x>=0)for(var v=c[x],g=v[v.length-1]-f[p],m=p;m<h;++m)c[x].push(f[m+1]+g);p=f[p],h=f[h]}h!==p&&(r.push([p,h]),o+=h-p)}return{outSplits:c,valueSlices:r,numValues:o}}function Dn(e,n){for(var t=e.slice(0,n);t.length<n;)t.push(1);for(var a=n;a<e.length;a++)t[n-1]*=e[a];return t}function Pn(e,t,a,r,o){var i=t.slice();i[0]=o;var s=n.util.getArrayFromDType(a,n.util.sizeFromShape(i)),u=e.length;return function(e,n,t,a,r,o){var i,s,u=Dn(n,2)[1],l=Dn(o,2)[1],d=0;try{for(var p=c(t),h=p.next();!h.done;h=p.next())for(var f=h.value,x=f[0];x<f[1];++x){for(var v=0;v<a;++v)r[d*l+v]=e[x*u+v];++d}}catch(e){i={error:e}}finally{try{h&&!h.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}}(e,t,r,0===u?0:u/t[0],s,i),[s,i]}var Ln=2147483647;var Bn=n.backend_util.RowPartitionType,Vn=function(){function e(e,t,a,r,o,i,c,s,u,l){this.shape=e,this.shapeShape=t,this.values=a,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=c,this.rowPartitionValues=s,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=n.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=n.backend_util.getRaggedRank(this.rowPartitionTypes)}return e.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Bn.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},e.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Bn.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},e.prototype.getMaxWidth=function(n){var t=this.getRowPartitionTensor(n-1);switch(this.getRowPartitionTypeByDimension(n-1)){case Bn.VALUE_ROWIDS:return e.getMaxWidthValueRowID(t);case Bn.ROW_SPLITS:return e.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Bn[this.getRowPartitionTypeByDimension(n-1)]))}},e.getMaxWidthRowSplit=function(e){var n=e.length;if(0===n||1===n)return 0;for(var t=0,a=0;a<n-1;++a){var r=e[a+1]-e[a];r>t&&(t=r)}return t},e.getMaxWidthValueRowID=function(e){var n=e.length;if(0===n)return 0;for(var t=0,a=e[0],r=0,o=1;o<n;++o){var i=e[o];i!==a&&(a=i,r=Math.max(o-t,r),t=o)}return Math.max(n-t,r)},e.prototype.tensorShapeFromTensor=function(e,n,t){if(void 0===t&&(t=!0),0===n.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Un(e,t)},e.prototype.calculateOutputSize=function(e){var t=this.valuesShape,a=this.defaultValueShape;n.backend_util.validateDefaultValueShape(a,t);var r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=n.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(var i=1;i<=this.raggedRank;++i)o[i]<0&&(o[i]=this.getMaxWidth(i));return o},e.prototype.calculateFirstParentOutputIndex=function(e,t,a){for(var r=Math.min(e,a),o=[],i=0,c=0;c<r;++c,i+=t)o.push(i);for(c=r;c<e;++c)o.push(-1);return n.util.assert(o.length===e,(function(){return"Final length of result must be equal to firstDimension."})),o},e.prototype.calculateOutputIndexRowSplit=function(e,n,t,a){for(var r=e.length,o=[],i=0;i<r-1;++i){var c=e[i+1]-e[i],s=Math.min(a,c),u=n[i];-1===u&&(s=0);for(var l=0;l<s;++l)o.push(u),u+=t;for(l=0;l<c-s;++l)o.push(-1)}if(r>0&&o.length!==e[r-1])throw new Error("Invalid row split size.");return o},e.prototype.calculateOutputIndexValueRowID=function(e,n,t,a){var r=e.length,o=[];if(0===r)return[];var i=0,c=e[0];if(c>=n.length)throw new Error("Got currentValueRowId=".concat(c,", which is not less than ").concat(n.length));var s=n[c];o.push(s);for(var u=1;u<r;++u){var l=e[u];if(l===c)s>=0&&(++i<a?s+=t:s=-1);else{if(i=0,c=l,l>=n.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(n.length));s=n[l]}o.push(s)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},e.prototype.calculateOutputIndex=function(e,n,t,a){var r=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Bn.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,n,t,a);case Bn.ROW_SPLITS:if(r.length-1>n.length)throw new Error("Row partition size is greater than output size: ".concat(r.length-1," > ").concat(n.length));return this.calculateOutputIndexRowSplit(r,n,t,a);default:throw new Error("Unsupported partition type: ".concat(Bn[o]))}},e.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var n=this.rowPartitionTypes[0];switch(n){case Bn.FIRST_DIM_SIZE:return e[0];case Bn.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Bn.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Bn[n]))}},e.prototype.compute=function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var r=a.length-2;r>=0;--r)a[r]=a[r+1]*t[r+1];var o=Un(t,!1),i=n.util.getArrayFromDType(this.valuesDType,n.util.sizeFromShape(o));if(a[0]*t[0]>0){var c=this.calculateFirstParentOutputIndex(e,a[0],t[0]);for(r=1;r<=this.raggedRank;++r){c=this.calculateOutputIndex(r-1,c,a[r],t[r])}this.setOutput(this.raggedRank,c,i,o)}return[o,i]},e.prototype.setOutput=function(e,t,a,r){if(0!==a.length){var o=this.values,i=a,c=r.slice();c=c.slice(e+1);var s=n.util.sizeFromShape(c),u=t.length,l=this.defaultValue;if(l.length!==s&&1!==l.length){var d=this.defaultValueShape;n.tidy((function(){var e=n.reshape(l,d),t=n.broadcastTo(e,c);l=t.dataSync()}))}for(var p=0,h=0,f=0,x=0;x<=u;++x){var v=x<u?t[x]:-1;if(v!==f){if(h<f){var g=o.subarray(p*s);Wn(i.subarray(h*s),g,(f-h)*s)}if(x>=u){var m=a.length;v=Math.floor(m/s)}if(v>f)if(1===this.defaultValue.length)i.subarray(f*s,v*s).fill(this.defaultValue[0]),f=v;else for(;v>f;){Wn(i.slice(f*s),l,s),++f}v<0?(p=x+1,h=f):(p=x,f=(h=f)+1)}else++f}}},e}();function Wn(e,n,t){for(var a=0;a<t;a++)e[a]=n[a]}function Un(e,n){var t,a,r=[];try{for(var o=c(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(s<0){if(!n)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}r.push(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(a=o.return)&&a.call(o)}finally{if(t)throw t.error}}return r}var Mn=mn((function(e){return 1/Math.sqrt(e)}));var Gn=mn((function(e){return 1/(1+Math.exp(-e))}));var zn=mn((function(e){return Math.sqrt(e)})),Xn=mn((function(e,n){var t=n.pattern,a=n.replaceGlobal,r=n.rewrite;return e.replace(new RegExp(t,a?"g":""),r)}));var Hn=function(){function e(e,t,a,r,o,i){this.separator=n.util.encodeString(e),this.nGramWidths=t,this.leftPad=n.util.encodeString(a),this.rightPad=n.util.encodeString(r),this.padWidth=o,this.preserveShort=i}return e.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},e.prototype.getNumNGrams=function(e,n){var t=this.getPadWidth(n);return Math.max(0,e+2*t-n+1)},e.prototype.createNGrams=function(e,n,t,a,r,o){for(var i=function(i){var s=c.getPadWidth(o),u=Math.max(0,s-i),l=Math.max(0,s-(r-(i+1))),d=o-(u+l),p=n+(u>0?0:i-s),h=0;h+=u*c.leftPad.length;for(var f=0;f<d;++f)h+=e[p+f].length;h+=l*c.rightPad.length,h+=(u+l+d-1)*c.separator.length,t[a+i]=new Uint8Array(h);var x=t[a+i],v=0,g=function(e){return e.forEach((function(e){return x[v++]=e}))};for(f=0;f<u;++f)g(c.leftPad),g(c.separator);for(f=0;f<d-1;++f)g(e[p+f]),g(c.separator);if(d>0){g(e[p+d-1]);for(f=0;f<l;++f)g(c.separator),g(c.rightPad)}else{for(f=0;f<l-1;++f)g(c.rightPad),g(c.separator);g(c.rightPad)}},c=this,s=0;s<r;++s)i(s)},e.prototype.compute=function(e,t){var a=this,r=e.length,o=t.length;if(o>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var c=1;c<o;++c){var s=t[c]>=i;if(!(s=s&&t[c]<=r))throw new Error("Invalid split value ".concat(t[c],", must be in [").concat(i,", ").concat(r,"]"));i=t[c]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=o-1,l=n.util.getArrayFromDType("int32",o);if(0===r||0===o){var d=new Array(r);for(c=0;c<=u;++c)l[c]=0;return[d,l]}l[0]=0;var p=function(e){var n=t[e]-t[e-1],r=0;h.nGramWidths.forEach((function(e){r+=a.getNumNGrams(n,e)})),h.preserveShort&&n>0&&0===r&&(r=1),l[e]=l[e-1]+r},h=this;for(c=1;c<=u;++c)p(c);var f=new Array(l[u]),x=function(n){var r=t[n],o=l[n];if(v.nGramWidths.forEach((function(i){var c=t[n+1]-t[n],s=a.getNumNGrams(c,i);a.createNGrams(e,r,f,o,s,i),o+=s})),v.preserveShort&&o===l[n]){var i=t[n+1]-t[n];if(0===i)return"continue";var c=i+2*v.padWidth;v.createNGrams(e,r,f,o,1,c)}},v=this;for(c=0;c<u;++c)x(c);return[f,l]},e}();function jn(e,n,t,a){if(e.length)if(0!==n.length)if(1!==n.length){var r=0;for(s=0;s<e.length+1;s++)if(s===e.length||-1!==n.indexOf(e[s])){c=e.subarray(r,s);t&&0===c.length||a.push(c),r=s+1}}else{for(var o=n[0],i=e.indexOf(o);-1!==i;){var c=e.subarray(0,i);t&&0===c.length||a.push(c),i=(e=e.subarray(i+1)).indexOf(o)}t&&0===e.length||a.push(e)}else for(var s=0;s<e.length;++s)a.push(e.subarray(s,s+1))}var Kn=xn((function(e,n){return e-n}));var qn=function(e,n){var t=n.value-e.value;return 0===t?e.index-n.index:t};function Yn(e,t,a,r){for(void 0===a&&(a=0),void 0===r&&(r=e.length-1);r>a;){if(r-a>600){var o=r-a+1,i=t-a+1,c=Math.log(o),s=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*s*(o-s)/o)*Math.sign(i-o/2);Yn(e,t,Math.max(a,Math.floor(t-i*s/o+u)),Math.min(r,Math.floor(t+(o-i)*s/o+u)))}var l=e[t],d=a,p=r;for(n.util.swap(e,a,t),qn(e[r],l)>0&&n.util.swap(e,a,r);d<p;){for(n.util.swap(e,d,p),d++,p--;qn(e[d],l)<0;)d+=1;for(;qn(e[p],l)>0;)p-=1}0===qn(e[a],l)?n.util.swap(e,a,p):(p+=1,n.util.swap(e,p,r)),p<=t&&(a=p+1),t<=p&&(r=p-1)}}var Qn=vn,Zn=function(e,t,a,r,o){for(var i=n.util.sizeFromShape(r),c=n.util.makeZerosTypedArray(o,a),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=o||(c[u]+=i>0?t[s]:1)}return c},Jn=function(e,t,a,r){void 0===r&&(r=!1);for(var o=e.shape[0],i=e.shape[1],c=n.buffer([o,a],t.dtype),s=0;s<o;s++)for(var u=0;u<i;u++){var l=e.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=a||(r?c.set(1,s,l):t.size>0?c.set(c.get(s,l)+t.get(s,u),s,l):c.set(c.get(s,l)+1,s,l))}return c},$n=gn,et=function(e,t,a,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var o=n.util.toTypedArray([0],a),i=s(xn((function(e,n){return e!==n?1:0}))(t,[],e,o,"bool"),2),c=i[0];return[i[1],"bool",c]}throw new Error("Error in Cast: failed to cast ".concat(a," to ").concat(r))},nt=bn,tt=function(e,t,a,r){var o=n.util.getArrayFromDType(a,n.util.sizeFromShape(t));if(r&&"string"!==a){var i=0;e.forEach((function(e){var t=n.util.sizeFromShape(e.shape);o.set(e.vals,i),i+=t}))}else{var c=0;e.forEach((function(e){for(var r="string"===a?n.backend_util.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+c,l=0;l<e.shape[1];++l)o[u+l]=r[i++];c+=e.shape[1]}))}return o},at=Cn,rt=yn,ot=wn,it=In,ct=function(e,t,a,r,o,i,c,l,d){for(var p=n.buffer([r,i],a),h=0;h<r;h++){for(var f=[],x=0,v=0;v<o;v++){var g=e[h*o+v];x+=g*c[v],f.push(g)}if(x<0||x>=d/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(l));for(var m=0;m<i;m++)p.values[h*i+m]=t.get.apply(t,u([],s(t.indexToLoc(x*i+m)),!1))}return p},st=function(e,t,a){for(var r=n.buffer(a,e.dtype),o=0;o<r.size;++o){var i=r.indexToLoc(o).slice(),c=i[0],s=i[2],u=t.locToIndex([c,s]);i[2]=t.values[u];var l=e.locToIndex(i);0<=l&&l<e.values.length&&(r.values[o]=e.values[l])}return r},ut=Sn,lt=kn,dt=Rn,pt=Tn,ht=function(e,t,a){var r=(t-e)/(a-1),o=n.util.makeZerosTypedArray(a,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return o},ft=Nn,xt=function(e,t,a,r){for(var o=n.util.getTypedArrayFromDType(r,n.util.sizeFromShape(a)),i=0;i<o.length;++i){for(var c=i*t,s=e[c],u=0;u<t;++u){var l=e[c+u];(Number.isNaN(l)||l>s)&&(s=l)}o[i]=s}return o},vt=En,gt=An,mt=_n,bt=function(e,t,a){var r=n.util.createScalarValue(-1,a);return _n([],t,r,e,a)},Ct=On,yt=function(e,t,a,r){for(var o=s(n.backend_util.computeOutAndReduceShapes(e,r),2),i=o[0],c=o[1],u=n.upcastType(t,"int32"),l=n.util.makeZerosTypedArray(n.util.sizeFromShape(i),u),d=n.util.sizeFromShape(c),p=0;p<l.length;++p){for(var h=p*d,f=1,x=0;x<d;++x)f*=a[h+x];l[p]=f}return{outVals:l,outShape:i,outDtype:u}},wt=function(e,t,a,r,o,i,c,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,a){e.forEach((function(e,r){if(e<0||e>=a){var o=n.util.indexToLoc(r,t.length,n.util.computeStrides(t)).join(",");throw new Error("indices[".concat(o,"] = ").concat(e," is not in [0, ").concat(a,")"))}}))}(i,c,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=Fn(i,c,e,r[0]),l=u.outSplits,d=u.valueSlices,p=u.numValues,h=function(e){for(var t=[],a=function(a){var r=e[a].length,o=n.util.getArrayFromDType("int32",r);t.push(o),e[a].forEach((function(e,n){return o[n]=e}))},r=0;r<e.length;++r)a(r);return t}(l),f=Pn(a,r,o,d,p);return[h,f[0],f[1]]},It=function(e,t,a,r,o,i,c){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(c.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===o.length,l=0===c.length,d=[];s||d.push(t[0]),u||d.push(o[0]),l||d.push(c[0]);for(var p=1;p<d.length;++p)if(d[p]!==d[p-1])throw new Error("starts, limits, and deltas must have the same shape");var h=0===d.length?1:d[0],f=n.util.getArrayFromDType("int32",h+1);f[0]=0;for(var x=0;x<h;++x){var v=s?e[0]:e[x],g=u?r[0]:r[x];if(0===(S=l?i[0]:i[x]))throw new Error("Requires delta != 0");var m=void 0;if(S>0&&g<v||S<0&&g>v)m=0;else if((m=Math.ceil(Math.abs((g-v)/S)))>Ln)throw new Error("Requires ((limit - start) / delta) <= ".concat(Ln));f[x+1]=f[x]+m}var b=f[h],C=n.util.getArrayFromDType(a,b),y=0;for(x=0;x<h;++x){var w=f[x+1]-f[x],I=s?e[0]:e[x],S=l?i[0]:i[x];for(p=0;p<w;++p)C[y++]=I,I+=S}return[f,C]},St=function(e,n,t,a,r,o,i,c,s,u){return new Vn(e,n,t,a,r,o,i,c,s,u).compute()},kt=function(e,t,a,r){if(e===t||e<t&&a<0||t<e&&a>1)return n.util.makeZerosTypedArray(0,r);var o=Math.abs(Math.ceil((t-e)/a)),i=n.util.makeZerosTypedArray(o,r);t<e&&1===a&&(a=-1),i[0]=e;for(var c=1;c<i.length;c++)i[c]=i[c-1]+a;return i},Rt=Mn,Tt=function(e,t,a,r,o,i,c,s,u,l){var d=[r/o,o],p=e.values,h=t.values;if(0===r)return n.buffer(a,t.dtype);var f=u instanceof n.TensorBuffer?u:n.buffer(d,t.dtype);"string"==typeof u||"number"==typeof u?f.values.fill(u):"boolean"==typeof u&&f.values.fill(+u);for(var x=0;x<i;x++){for(var v=[],g=0,m=0;m<c;m++){var b=p[x*c+m];v.push(b),g+=b*s[m]}if(g<0||g>=r/o)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(a));for(var C=0;C<o;C++)l?f.values[g*o+C]+=h[x*o+C]:f.values[g*o+C]=0===t.rank?h[0]:h[x*o+C]}return f},Nt=Gn,Et=function(e){for(var n=new Float32Array(e.length),t=0;t<e.length;++t)n[t]=Math.abs(e[t]);return n},At=function(e,t,a,r,o){var i=n.slice_util.isSliceContinous(r,t,a),c=n.util.sizeFromShape(a),l=n.util.computeStrides(r);if(i){var d=n.slice_util.computeFlatOffset(t,l);return"string"===o?e.slice(d,d+c):e.subarray(d,d+c)}for(var p="string"===o?n.backend_util.fromUint8ToStringArray(e):e,h=n.buffer(r,o,p),f=n.buffer(a,o),x=0;x<f.size;++x){var v=f.indexToLoc(x),g=v.map((function(e,n){return e+t[n]}));f.set.apply(f,u([h.get.apply(h,u([],s(g),!1))],s(v),!1))}return"string"===o?n.backend_util.fromStringArrayToUint8(f.values):f.values},_t=function(e,t,a,r,o,i,c){var s=t[0],u=i[0],l=new Array(u),d=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(n.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[C=n.util.getArrayFromDType(a,0),[0,p],y=n.util.getArrayFromDType(o,0),l,d]}for(var h=!0,f=0,x=new Array(u).fill(0),v=0;v<s;++v){if((m=e[v*p])<0)throw new Error(n.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(v,m));if(m>=u)throw new Error(n.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(v,m,u));++x[m],h=h&&m>=f,f=m}for(var g=!0,m=0;m<u;++m){var b=0===x[m];l[m]=b,g=g&&!b,x[m]=Math.max(x[m],1),m>0&&(x[m]+=x[m-1])}if(g&&h){var C=e,y=r;for(v=0;v<s;++v)d[v]=v;return[C,[s,p],y,l,d]}var w=x[u-1],I=(C=n.util.getArrayFromDType(a,w*p),y=n.util.getArrayFromDType(o,w),new Array(u).fill(0));for(v=0;v<s;++v){var S=I[m=e[v*p]],k=(0===m?0:x[m-1])+S;I[m]++;for(var R=0;R<p;++R)C[k*p+R]=e[v*p+R];y[k]=r[v],d[v]=k}for(m=0;m<u;++m){if(0===I[m]){var T=0===m?0:x[m-1];C[T*p+0]=m;for(var N=1;N<p;++N)C[T*p+N]=0;y[T]=c}}return[C,[w,p],y,l,d]},Ot=function(e,t,a,r,o){for(var i=n.util.sizeFromShape(r),c=t[0],s=o.length,u=[],l=1,d=-1,p=0;p<s;++p){var h=o[p];if(-1===h){if(-1!==d)throw new Error(n.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(d,p));d=p,u.push(1)}else{if(h<0)throw new Error(n.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(p,h));l*=h,u.push(h)}}if(-1!==d){if(l<=0)throw new Error(n.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var f=Math.trunc(i/l);if(l*f!==i)throw new Error(n.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[d]=f}if(n.util.sizeFromShape(u)!==i)throw new Error(n.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var x=r.length,v=[];if(x>0){v[x-1]=1;for(p=x-2;p>=0;--p)v[p]=v[p+1]*r[p+1]}var g=[];if(s>0){g[s-1]=1;for(p=s-2;p>=0;--p)g[p]=g[p+1]*u[p+1]}for(var m=n.util.getArrayFromDType(a,c*s),b=0;b<c;++b){for(var C=0,y=0;y<x;++y)C+=e[b*x+y]*v[y];for(y=0;y<s;++y)m[b*s+y]=Math.trunc(C/g[y]),C%=g[y]}return[m,[c,s],u]},Ft=function(e,t,a,r,o,i,c){void 0===i&&(i=!1),void 0===c&&(c=0);var s=r.length,u=[t[0],e.length/t[0]],l=u[1],d=s>0?o[s-1]+1:0;if(d<0)throw new Error(n.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var p=t.slice();p[0]=d;var h=p.reduce((function(e,n){return e*n}),1),f=n.util.getArrayFromDType(a,h);if(0===s)return d>0&&f.fill(c),[f,p];if(d<=0)throw new Error(n.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var x=0,v=1,g=0,m=o[x];;){var b=0;if(v<s){if(m===(b=o[v])){++v;continue}if(m>=b)throw new Error(n.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(m<0||m>=d)throw new Error(n.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(m,d));m>g&&f.fill(c,g*l,m*l);for(var C=x;C<v;++C){var y=r[C];if(y<0||y>=u[0])throw new Error(n.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(C,r[C],u[0]));for(var w=0;w<l;w++)f[m*l+w]+=e[y*l+w]}if(i)for(w=0;w<l;w++)f[m*l+w]/=v-x;if(x=v,g=m+1,m=b,++v>s)break}return g<d&&f.fill(c,g*l,d*l),[f,p]},Dt=zn,Pt=Xn,Lt=function(e,t,a,r){for(var o=n.buffer(e,t.dtype),i=0;i<o.size;i++){for(var c=o.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[d]*a[d]+r[d];o.set.apply(o,u([t.get.apply(t,u([],s(l),!1))],s(c),!1))}return o},Bt=function(e,n,t,a,r,o,i,c){return new Hn(t,a,r,o,i,c).compute(e,n)},Vt=function(e,t,a){for(var r=e.length,o=[],i=0,c=0,s=new Array(r),u=0;u<r;++u){var l=o.length;jn(e[u],t,a,o);var d=o.length-l;s[u]=d,i+=d,c=Math.max(c,d)}var p=n.util.getArrayFromDType("int32",2*i),h=new Array(i),f=[r,c],x=0;for(u=0;u<r;++u)for(var v=0;v<s[u];++v)p[2*x]=u,p[2*x+1]=v,h[x]=o[x],++x;return[p,h,f]},Wt=function(e,t){for(var a=n.util.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)a[r]=n.util.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return a},Ut=Kn,Mt=function(e,t){for(var a=new Array(e.rank),r=0;r<a.length;r++)a[r]=e.shape[r]*t[r];var o=n.buffer(a,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),c=new Array(e.rank),s=0;s<c.length;s++)c[s]=i[s]%e.shape[s];var u=e.locToIndex(c);o.values[r]=e.values[u]}return o},Gt=function(e,t,a,r,o){for(var i=t[t.length-1],c=s([e.length/i,i],2),u=c[0],l=c[1],d=n.util.getTypedArrayFromDType(a,u*r),p=n.util.getTypedArrayFromDType("int32",u*r),h=function(n){var t=n*l,a=e.subarray(t,t+l),i=new Array(a.length);a.forEach((function(e,n){return i[n]={value:e,index:n}})),r<i.length&&(Yn(i,r),i=i.slice(0,r)),o&&i.sort(qn);for(var c=n*r,s=d.subarray(c,c+r),u=p.subarray(c,c+r),h=0;h<r;h++)s[h]=i[h].value,u[h]=i[h].index},f=0;f<u;f++)h(f);var x=t.slice();return x[x.length-1]=r,[n.buffer(x,a,d),n.buffer(x,"int32",p)]},zt=function(e,t,a,r,o){for(var i=t.length,c=n.util.sizeFromShape(t),s=n.util.computeStrides(t),u=n.util.computeStrides(o),l=n.util.getTypedArrayFromDType(a,n.util.sizeFromShape(o)),d=0;d<c;++d){for(var p=n.util.indexToLoc(d,i,s),h=new Array(p.length),f=0;f<h.length;f++)h[f]=p[r[f]];l[n.util.locToIndex(h,i,u)]=e[d]}return l},Xt=function(e,t,a,r){for(var o=n.util.parseAxisParam(t,a)[0],i=[1,a[0],1],c=0;c<o;c++)i[0]*=a[c];for(i[1]=a[o],c=o+1;c<a.length;c++)i[2]*=a[c];var s=new Map,u=new Int32Array(a[o]),l=new n.TensorBuffer(i,r,e),d=[],p=1===i[0]&&1===i[2];for(c=0;c<a[o];c++){var h=void 0;if(p)h=e[c].toString();else{for(var f=[],x=0;x<i[0];x++)for(var v=0;v<i[2];v++)f.push(l.get(x,c,v));h=f.join(",")}var g=s.get(h);if(null!=g)u[c]=g;else{var m=s.size;s.set(h,m),u[c]=m,d.push(c)}}var b=i.slice();b[1]=s.size;var C=new n.TensorBuffer(b,r);d.forEach((function(e,n){for(var t=0;t<i[0];t++)for(var a=0;a<i[2];a++)C.set(l.get(t,e,a),t,n,a)}));var y=a.slice();return y[o]=b[1],{outputValues:C.values,outputShape:y,indices:u}};function Ht(e,n){return["x","y","z","w","u","v"].slice(0,n).map((function(n){return"".concat(e,".").concat(n)}))}function jt(e,n){return 1===n?[e]:Ht(e,n)}var Kt=function(){function e(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Le(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=jt("rc",this.rank),t=Ae(this.rank),a=this.getOutOfBoundsCondition(n),r=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(t," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else 